<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Consulta - GeoIPT</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.5;
        }

        h2 {
            margin-top: 0;
        }

        .reporte {
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        #btnPDF {
            display: none; /* se mostrar√° solo si hubo match */
            background-color: #1e88e5;
            color: white;
            padding: 12px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        #btnPDF:hover {
            background-color: #0d47a1;
        }
    </style>

    <!-- Librer√≠a para generar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

</head>
<body>

    <h2>Informe de Consulta Territorial</h2>

    <div id="reporte" class="reporte">
        <p><strong>Coordenadas consultadas:</strong></p>
        <p id="coords"></p>

        <hr>

        <div id="resultado">
            <!-- Aqu√≠ se llenar√° con los pol√≠gonos encontrados -->
        </div>
    </div>

    <!-- Bot√≥n PDF: aparece solo si hubo match -->
    <button id="btnPDF" onclick="generarPDF()">üìÑ Compartir / Descargar PDF</button>

    <script>
        // ------- 1) Recibir datos desde index.html --------
        const urlParams = new URLSearchParams(window.location.search);
        const lat = urlParams.get("lat");
        const lon = urlParams.get("lon");
        const matches = JSON.parse(urlParams.get("matches") || "[]");

        document.getElementById("coords").innerHTML =
            `Lat: ${lat}<br>Lon: ${lon}`;

        // ------- 2) Mostrar resultados --------
        const cont = document.getElementById("resultado");

        if (matches.length === 0) {
            cont.innerHTML = "<p><strong>No se encontraron pol√≠gonos para este punto.</strong></p>";
        } else {
            let html = "<h3>Coincidencias encontradas:</h3>";
            matches.forEach((m, i) => {
                html += `
                    <p>
                        <strong>Pol√≠gono ${i + 1}</strong><br>
                        Nombre: ${m.name}<br>
                        Categor√≠a: ${m.category}<br>
                    </p>
                `;
            });

            cont.innerHTML = html;

            // Si hubo match ‚Üí mostrar bot√≥n PDF
            document.getElementById("btnPDF").style.display = "block";
        }

        // ------- 3) Funci√≥n para generar PDF --------
        function generarPDF() {
            const elemento = document.getElementById("reporte");

            const opciones = {
                margin: 10,
                filename: `GeoIPT_consulta_${lat}_${lon}.pdf`,
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'letter', orientation: 'portrait' }
            };

            html2pdf().from(elemento).set(opciones).save();
        }
    </script>

</body>
</html>
