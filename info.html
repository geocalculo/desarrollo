<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Consulta - GeoIPT</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.5;
        }

        h2 {
            margin-top: 0;
        }

        .reporte {
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        #btnPDF {
            display: none;
            background-color: #1e88e5;
            color: white;
            padding: 12px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        #btnPDF:hover {
            background-color: #0d47a1;
        }

        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

</head>
<body>

    <h2>Informe de Consulta Territorial</h2>

    <div id="reporte" class="reporte">
        <p><strong>Coordenadas consultadas:</strong></p>
        <p id="coords"></p>

        <hr>

        <div id="resultado"></div>
    </div>

    <button id="btnPDF" class="no-print" onclick="generarPDF()">ðŸ“„ Compartir / Descargar PDF</button>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const lat = urlParams.get("lat");
        const lon = urlParams.get("lon");
        const matches = JSON.parse(urlParams.get("matches") || "[]");

        document.getElementById("coords").innerHTML =
            `Lat: ${lat}<br>Lon: ${lon}`;

        const cont = document.getElementById("resultado");

        if (matches.length === 0) {
            cont.innerHTML = "<p><strong>No se encontraron polÃ­gonos para este punto.</strong></p>";
        } else {
            let html = "<h3>Coincidencias encontradas:</h3>";
            matches.forEach((m, i) => {
                html += `
                    <p>
                        <strong>PolÃ­gono ${i + 1}</strong><br>
                        Nombre: ${m.name}<br>
                        CategorÃ­a: ${m.category}<br>
                    </p>
                `;
            });

            cont.innerHTML = html;
            document.getElementById("btnPDF").style.display = "inline-block";
        }

        function generarPDF() {
            const elemento = document.body;

            const opciones = {
                margin:       10,
                filename:     `GeoIPT_consulta_${lat}_${lon}.pdf`,
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'mm', format: 'letter', orientation: 'portrait' }
            };

            html2pdf().from(elemento).set(opciones).save();
        }
    </script>

</body>
</html>
