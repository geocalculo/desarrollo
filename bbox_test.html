<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>BBOX Debug - GeoIPT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #0b1120;
      color: #e5e7eb;
    }

    #map {
      width: 100vw;
      height: 70vh;
    }

    #panel {
      padding: 12px;
      background: #111827;
      border-top: 1px solid #1f2937;
      font-size: 14px;
      line-height: 1.5;
    }

    .bbox-box {
      margin-top: 6px;
      padding: 8px;
      background: #1f2937;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <div id="panel">
    <b>ðŸ“Œ DEBUG BBOX + CLICK</b>
    <div class="bbox-box">
      <div><b>Lat/Lon clic:</b> <span id="latlon"></span></div>
      <div><b>BBOX visible:</b></div>
      <div id="bbox"></div>
    </div>
  </div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // ---------------------------
    // MAPA BASE
    // ---------------------------
    const map = L.map("map").setView([-33.45, -70.66], 12);

    L.tileLayer("https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}", {
      maxZoom: 20,
      attribution: "Google Roads"
    }).addTo(map);

    // RectÃ¡ngulo del BBOX
    let bboxLayer = L.rectangle([[0, 0],[0, 0]], {
      color: "red",
      weight: 1
    }).addTo(map);

    // ---------------------------
    // FUNCIÃ“N: ACTUALIZA EL BBOX
    // ---------------------------
    function actualizarBBOX() {
      const b = map.getBounds();

      const bbox = {
        minLat: b.getSouth(),
        minLon: b.getWest(),
        maxLat: b.getNorth(),
        maxLon: b.getEast()
      };

      // actualiza rectÃ¡ngulo
      bboxLayer.setBounds([
        [bbox.minLat, bbox.minLon],
        [bbox.maxLat, bbox.maxLon]
      ]);

      // muestra en pantalla
      document.getElementById("bbox").innerHTML =
        `
        minLat: ${bbox.minLat.toFixed(6)}<br>
        minLon: ${bbox.minLon.toFixed(6)}<br>
        maxLat: ${bbox.maxLat.toFixed(6)}<br>
        maxLon: ${bbox.maxLon.toFixed(6)}
        `;

      return bbox;
    }

    map.on("moveend", actualizarBBOX);
    map.whenReady(actualizarBBOX);

    // ---------------------------
    // CAPTURA CLIC
    // ---------------------------
    map.on("click", function (e) {
      const lat = e.latlng.lat.toFixed(6);
      const lon = e.latlng.lng.toFixed(6);

      document.getElementById("latlon").innerText = `${lat}, ${lon}`;

      // Obtener BBOX actual
      const bbox = actualizarBBOX();

      console.log("CLICK â†’", {
        lat,
        lon,
        bbox
      });
    });

  </script>
</body>
</html>
